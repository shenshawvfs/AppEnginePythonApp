<!-- Template componet for sub page within home page -->
<div id="sub-panel">

    <form id="sub-submit" name="Create Persona">
        Player Name: <input type="text" name="PlayerName" value={{ player_name }} />
        Persona Name: <input type="text" name="PersonaName" value={{ persona_name }} />
        <input type="submit" value="Add" />
        <input type="hidden" name="cmd" value="add_user" />
    </form>

    <div id='status'></div>
    
</div>


<script type="text/javascript" id="editor_js">

    /*
     *  This singleton object controlls the template code above
     */
	var subPanel = (function() {
	
	    function SubPanelController() {

	        var local = {};
	        var self = this;
	    
	        self.init = function() {
	            
	            $("#sub-submit").on('submit', function( event ) {
	                event.preventDefault();	                
	                local.savePlayer();
                });
            }; 
	    
            
            local.savePlayer = function() {
	        
    	        // Post request for data to the server (python code)
    	        $('#status').html("");  // clear the result
    	        
    	        var instr = $("#sub-submit").serialize();
    	        $.post( '/sub', instr )
    	            .then( function( data ) {
    	                
    	                var result = local.resultFromData( data );
    	                
    	                if (result.returnCode === 0) {
    	        
    	                    // screen element update( obj.playerJSON );
    	                    local.render( result );
    	        
    	                } else if (result.returnCode === -1) {
    	        
    	                    window.location = '/';
    	                    return;
    	                }
    	            });
    	    };
	    
    	    
    	    local.resultFromData = function( data ) {

                var result = null; 
    	        switch (typeof data) {
    	            case 'string':
    	                var result = $.parseJSON( data );
    	                break;
    	                
    	            case 'object':
    	                var result = data;
    	                break;
                    
	                default:
                        var result = null; 
	                    break;
                }
    	        return result;
    	    };
    	    
    	    
            local.render = function( data ) {
	        
    	        $("input[name='PlayerName']").val( data.playerName );
    	        $("input[name='DriverName']").val( data.driverName );
    	        
    	        $('#status').html("User " + data.playerName + " logged in as " + data.driverName );
	        };
	    };
	    return new SubPanelController();
	    
	})().init();
    
</script>